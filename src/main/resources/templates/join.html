<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">>
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <title>가입</title>

    <script>

        function save(){
            const username = document.getElementById("name").value;
            const password = document.getElementById("password").value;
            const address1 = document.getElementById("input-address").value;
            const address2 = document.getElementById("input-detail-address").value;


            const userdata = {
                username :username,
                password : password,
                address : address1+","+address2
            }

            $.ajax({
                url :"/try-join",
                type:"post",
                dataType : "json", // ajax가 받을때 자료형
                contentType:"application/json", // 보낼때 자료형
                data: JSON.stringify(userdata),
                success:function(data){
                    console.log(data)

                    if(data.result == "성공!"){
                        alert("회원가입 성공")
                        location.href = "/";
                    }else{
                        alert("가입 실패 ㅠㅠ")
                    }

                    //console.log(result);
                },
                error: function (request, status, error){
                    console.log(error)
                    console.log(status)
                    console.log(request)
                    //실패햇을때 성공 로직.
                    alert("가입 실패");
                }
            })
        }

        function road() {
             const popup = window.open("/address-search","Popup", "width=800, height=700");

             popup.onbeforeunload=(data)=>{
                 console.log(data)
                 console.log("데이터 체크")
            }
             // 팝업창에 데이터 쓰기
             popup.document.write(data);
        }

        function test(){
            $.ajax({
                url: "https://business.juso.go.kr/addrlink/addrLinkUrl.do?confmKey=U01TX0FVVEgyMDIzMDUwMjE0MTI1MDExMzczNzM=&returnUrl=http://localhost:3030/road-return&resultType=4",
                type: "GET",
            })
        }
    </script>
</head>
<body>


<h1>회원가입</h1>

이름 : <input type="text" id="name" /><br>
비밀번호 : <input type="password" id="password" /><br>

주소 : <input readonly type="text" id="input-address" /><button onclick="road()">주소찾기</button><br>
<div hidden="hidden" id="details-div">
    상세 주소 : <input type="text" id="input-detail-address"/><br>
</div>


<button onclick="save()">가입하기</button>


</body>
</html>